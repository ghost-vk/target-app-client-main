<template>
  <div>
    <SectionHero>
      <SectionHeroMainTitle>
        –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã<br />–ø–æ —Ç–∞—Ä–≥–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ä–µ–∫–ª–∞–º–µ –≤ Instagram<br />–æ—Ç –ù–∞—Å—Ç–∏ –ß–µ—Ä–µ–ø–∞—Ö–∏–Ω–æ–π
      </SectionHeroMainTitle>
    </SectionHero>
    <div class="container sm:w-screen-sm max-w-screen-sm mx-auto">
      <AppHeadingThird title="–ü—Ä–æ –º–∞—Ç–µ—Ä–∏–∞–ª—ã" />
      <div class="text-base md:text-lg mb-16">
        <p class="mb-3">
          –ó–¥–µ—Å—å —è –¥–æ–±–∞–≤–ª—è—é —Å–≤–æ–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã. –Ø –¥—É–º–∞—é –º–Ω–æ–≥–∏–µ –Ω–∞–π–¥—É—Ç –∑–¥–µ—Å—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –¥–ª—è
          —Å–µ–±—è —Ç–µ–º—ã. –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –≤ —Å–≤–æ–∏—Ö —Ü–µ–ª—è—Ö. –ó–∞ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ —Å
          —É–∫–∞–∑–∞–Ω–∏–µ–º –∞–≤—Ç–æ—Ä–∞ +10 –∫ –∫–∞—Ä–º–µ üòÑ
        </p>
        <p class="mb-3">
          –ï—Å–ª–∏ –í–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è –º–∞—Ç–µ—Ä–∏–∞–ª, –º–æ–∂–µ—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å –º–Ω–µ —Å–≤–æ–π –æ—Ç–∑—ã–≤ –≤
          <a :href="contacts.telegram"><AppBlueUnderlineLink>—Ç–µ–ª–µ–≥—Ä–∞–º</AppBlueUnderlineLink></a>
          –∏–ª–∏ –≤
          <a :href="contacts.instagram"><AppBlueUnderlineLink>–¥–∏—Ä–µ–∫—Ç</AppBlueUnderlineLink></a>
          –±—É–¥—É –í–∞–º –ø—Ä–∏–∑–Ω–∞—Ç–µ–ª—å–Ω–∞! üòâ
        </p>
        <p class="mb-3">
          –¢–∞–∫–∂–µ –Ω–µ –∑–∞–±—ã–≤–∞–π—Ç–µ, —á—Ç–æ —É –º–µ–Ω—è –µ—Å—Ç—å —á–∞—Ç —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–æ–≤, –≤ –∫–æ—Ç–æ—Ä–æ–º —è –≤—ã–∫–ª–∞–¥—ã–≤–∞—é –∏–Ω—Ç–µ—Ä–µ—Å–Ω—É—é
          –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Ç–∞—Ä–≥–µ—Ç—É:
        </p>
        <AppTelegramChatPill />
      </div>
    </div>
    <div class="container pb-20">
      <AppHeadingThird title="–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã" />
      <template v-if="magnets && !magnetsLoadingStatus.loadingMagnets">
        <div
          class="
            grid grid-cols-2
            md:grid-cols-3
            xl:grid-cols-4
            2xl:grid-cols-5
            gap-2
            sm:gap-4
            2xl:gap-8
          "
        >
          <AppMagnetLidsItem
            v-for="m in magnets"
            :image="m.image"
            :title="m.name"
            :description="m.description"
            @get="startProcessGettingMagnet(m)"
            @show-info="() => {}"
          />
        </div>
      </template>
      <div v-if="magnetsLoadingStatus.loadingMagnets" class="vld-parent h-80 w-full mx-auto">
        <Loading
          :active="magnetsLoadingStatus.loadingMagnets"
          :is-full-page="false"
          :color="colors.main"
          :opacity="0"
        />
      </div>
      <div
        v-if="!magnets?.length && !magnetsLoadingStatus.loadingMagnets"
        class="container max-w-screen-sm text-center"
      >
        <div class="p-3 rounded-lg shadow bg-white">
          <EmojiSadIcon class="h-10 w-10 text-purple-400 mx-auto mb-3" />
          <p class="font-semibold text-lg">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã...</p>

          <AnalyticsLink
            route="–ø—Ä–æ—Ñ–∏–ª—å Instagram (–Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã)"
            :href="contacts.instagram"
            target="_blank"
          >
            <AppBlueUnderlineLink>–ù–∞–ø–∏—Å–∞—Ç—å –≤ Instagram</AppBlueUnderlineLink>
          </AnalyticsLink>
        </div>
      </div>
    </div>
    <AppReviewsSection v-intersection="setCurrentCategory" />
    <ModalLidForm title="–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞" />
    <ModalLidFormCallbackNotification :prolongation="30000">
      <div class="text-gray-700 text-lg font-semibold text-center">
        <div v-if="sendingStatus && link">
          –ï—Å–ª–∏ –≤–∞—Å –Ω–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏–ª–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º –º–∞—Ç–µ—Ä–∏–∞–ª–æ–º, –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å —ç—Ç–æ–π
          <a :href="link" target="_blank">
            <AppBlueUnderlineLink>—Å—Å—ã–ª–∫–æ–π</AppBlueUnderlineLink>
          </a>
        </div>
        <p v-else class="text-gray-700 text-lg font-semibold text-center">
          –í–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É –ø–æ–≤—Ç–æ—Ä–Ω–æ
        </p>
      </div>
    </ModalLidFormCallbackNotification>
  </div>
</template>

<script>
import SectionHero from '@/components/SectionHero.vue'
import SectionHeroMainTitle from '@/components/SectionHeroMainTitle.vue'
import ModalLidForm from '@/components/ModalLidForm.vue'
import ModalLidFormCallbackNotification from '@/components/ModalLidFormCallbackNotification.vue'
import AppMagnetLidsItem from '@/components/AppMagnetLidsItem.vue'
import Loading from 'vue-loading-overlay'
import { mapActions, mapGetters } from 'vuex'
import AppReviewsSection from '@/components/AppReviewsSection.vue'
import AppTelegramChatPill from '@/components/AppTelegramChatPill.vue'
import AnalyticsLink from '@/components/AnalyticsLink.vue'
import { EmojiSadIcon } from '@heroicons/vue/outline'

export default {
  components: {
    AppReviewsSection,
    AppTelegramChatPill,
    SectionHero,
    SectionHeroMainTitle,
    ModalLidForm,
    ModalLidFormCallbackNotification,
    AppMagnetLidsItem,
    EmojiSadIcon,
    AnalyticsLink,
    Loading,
  },
  methods: {
    ...mapActions({
      showDialog: 'lidForm/showDialog',
      setID: 'magnets/setID',
      onGettingMagnet: 'magnets/onGettingMagnet',
      loadMagnets: 'magnets/loadAll',
      updateActiveCategory: 'reviews/updateActiveCategory',
      updateLoadingPage: 'updateLoadingPage',
    }),
    async startProcessGettingMagnet(magnet) {
      try {
        await this.setID(magnet.id)
        if (this.isLeadSaved) {
          this.updateLoadingPage(true)
          await this.onGettingMagnet()
          this.updateLoadingPage(false)
        } else {
          this.showDialog({
            source: `–õ–∏–¥ –º–∞–≥–Ω–∏—Ç: "${magnet.name}"`,
            shouldCallback: false,
          })
        }
      } catch (err) {
        console.log(err)
      }
    },
    setCurrentCategory() {
      if (!this.isCatSet) {
        this.isCatSet = true
        this.updateActiveCategory('free-products')
      }
    },
  },
  computed: mapGetters({
    isLeadSaved: 'user/isLeadSaved',
    magnets: 'magnets/magnets',
    magnetsLoadingStatus: 'magnets/status',
    link: 'magnets/linkToRedirect',
    sendingStatus: 'lidForm/sendingStatus',
    colors: 'globalVars/colors',
    contacts: 'globalVars/contacts',
  }),
  data() {
    return {
      isCatSet: false,
    }
  },
  mounted() {
    this.loadMagnets()
    this.$gtag.event('page_view', { page_title: '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã' })
  },
}
</script>
